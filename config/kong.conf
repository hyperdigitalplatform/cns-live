# Kong Configuration File
# For RTA CCTV System

###############################################
# GENERAL
###############################################

# Prefix for Kong (installation directory)
prefix = /usr/local/kong/

# Log level
log_level = info

# Plugins
plugins = bundled,quota-validator

# Custom Lua plugins path
lua_package_path = /etc/kong/plugins/?.lua;;

###############################################
# DATABASE (DB-less mode for Phase 1)
###############################################

# Database mode: off for declarative config, postgres for production
database = off

# Declarative configuration file
declarative_config = /etc/kong/kong.yml

# Declarative configuration format version
declarative_config_format = kong_config_3_0

###############################################
# NGINX
###############################################

# Number of worker processes
nginx_worker_processes = auto

# Worker connections
nginx_worker_connections = 4096

# Upstream keepalive
nginx_http_upstream_keepalive = 320
nginx_http_upstream_keepalive_requests = 10000
nginx_http_upstream_keepalive_timeout = 60s

###############################################
# PROXY
###############################################

# Proxy listen addresses
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl

# Real IP headers (for clients behind load balancers)
real_ip_header = X-Forwarded-For
trusted_ips = 0.0.0.0/0,::/0

# Client body buffer size
client_body_buffer_size = 16k

# Max request body size (10MB for video metadata)
client_max_body_size = 10m

###############################################
# ADMIN API
###############################################

# Admin listen addresses
admin_listen = 0.0.0.0:8001, 0.0.0.0:8444 ssl

# Admin API access log
admin_access_log = logs/admin_access.log
admin_error_log = logs/admin_error.log

###############################################
# STATUS API
###############################################

# Status listen address
status_listen = 0.0.0.0:8100

###############################################
# DNS
###############################################

# DNS resolver
dns_resolver = 127.0.0.11:53

# DNS hostsfile
dns_hostsfile = /etc/hosts

# DNS order
dns_order = LAST,SRV,A,CNAME

# DNS cache
dns_stale_ttl = 10
dns_not_found_ttl = 1
dns_error_ttl = 1

###############################################
# LATENCY
###############################################

# Latency tokens
latency_tokens = 10000

###############################################
# SSL/TLS (Production)
###############################################

# SSL certificate (for production)
# ssl_cert = /etc/kong/ssl/rta.crt
# ssl_cert_key = /etc/kong/ssl/rta.key

# SSL protocols
ssl_protocols = TLSv1.2 TLSv1.3

# SSL ciphers
ssl_prefer_server_ciphers = on
ssl_ciphers = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384

###############################################
# PERFORMANCE
###############################################

# Memory cache size
mem_cache_size = 256m

# Nginx proxy buffers
nginx_proxy_buffer_size = 128k
nginx_proxy_buffers = 8 128k

###############################################
# VITALS (Metrics)
###############################################

# Disable vitals (using Prometheus instead)
vitals = off

###############################################
# LOGGING
###############################################

# Proxy access log format
nginx_proxy_access_log = logs/access.log combined
nginx_proxy_error_log = logs/error.log error

# Anonymous reports (disable in production)
anonymous_reports = off
