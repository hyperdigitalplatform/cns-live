# TURN Server Configuration (coturn)
# For WebRTC NAT traversal in RTA CCTV System

# Listening port for TURN
listening-port=3478

# TLS listening port
tls-listening-port=5349

# Listening IP
listening-ip=0.0.0.0

# External IP (to be set via environment variable)
external-ip=${EXTERNAL_IP}

# Relay IP
relay-ip=0.0.0.0

# Fingerprint for WebRTC
fingerprint

# Long-term credential mechanism
lt-cred-mech

# User credentials (to be set via environment)
user=${TURN_USER}:${TURN_PASSWORD}

# Realm for authentication
realm=rta.ae

# Total quota (5 GB per user)
user-quota=5000

# Bandwidth quota (50 Mbps)
bps-capacity=50000000

# Max relays per user
max-bps=50000000

# Minimum and maximum port for relay
min-port=50000
max-port=50500

# Verbose logging (set to 0 in production)
verbose

# Log file
log-file=/var/log/turnserver.log

# Disable UDP relay (use TCP only for reliability)
no-udp-relay

# Deny peer-to-peer connections
no-multicast-peers

# Disable loopback peers
no-loopback-peers

# Enable TURN REST API
use-auth-secret
static-auth-secret=${TURN_SECRET}

# Certificate for TLS (to be mounted)
cert=/etc/coturn/certs/turn.crt
pkey=/etc/coturn/certs/turn.key

# Disable CLI
no-cli

# Database for long-term credentials (optional)
# userdb=/var/lib/coturn/turndb

# Prometheus metrics (if supported)
prometheus

# Allowed peer IPs (LiveKit and MediaMTX)
allowed-peer-ip=10.0.0.0/8
allowed-peer-ip=172.16.0.0/12
allowed-peer-ip=192.168.0.0/16

# Denied peer IPs (security)
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=169.254.0.0-169.254.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.0.0.0-192.0.0.255
denied-peer-ip=192.0.2.0-192.0.2.255
denied-peer-ip=192.88.99.0-192.88.99.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=198.18.0.0-198.19.255.255
denied-peer-ip=198.51.100.0-198.51.100.255
denied-peer-ip=203.0.113.0-203.0.113.255
denied-peer-ip=224.0.0.0-255.255.255.255

# Mobility support
mobility

# Stale nonce (300 seconds)
stale-nonce=300
